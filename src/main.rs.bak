use aws_sdk_dynamodb::{Client, Error};
use aws_sdk_dynamodb::operation::put_item::PutItemInput;
use aws_sdk_dynamodb::operation::get_item::GetItemInput;
use aws_sdk_dynamodb::types::AttributeValue;
use aws_config::meta::region::RegionProviderChain;
use aws_config;
use dotenv::dotenv;

#[tokio::main]
async fn main() -> Result<(), Error> {
    dotenv().ok();

    let region_provider = RegionProviderChain::default_provider();
    let shared_config = aws_config::from_env().region(region_provider).load().await;

    let client = Client::new(&shared_config);

    // DynamoDBにアイテムを書き込む
    let put_item_input = PutItemInput::builder()
        .table_name("books")
        .item("id", AttributeValue::S("PrimaryKeyValue".to_string()))
        .item("sort", AttributeValue::S("SortKeyValue".to_string()))
        .build()
        .expect("Failed to build PutItemInput");

    client.put_item()
        .set_item(put_item_input.item().clone().cloned())
        .table_name(put_item_input.table_name.unwrap_or_default())
        .send()
        .await?;

    println!("Item inserted successfully.");

    // DynamoDBからアイテムを読み込む
    let get_item_input = GetItemInput::builder()
        .table_name("books")
        .key("id", AttributeValue::S("PrimaryKeyValue".to_string()))
        .key("sort", AttributeValue::S("SortKeyValue".to_string()))
        .build()
        .expect("Failed to build GetItemInput");

    let resp = client.get_item()
        .table_name(get_item_input.table_name.unwrap_or_default())
        .set_key(get_item_input.key)
        .send()
        .await?;

    if let Some(item) = resp.item {
        println!("Retrieved item: {:?}", item);
    } else {
        println!("Item not found.");
    }

    Ok(())
}
